# Implementation Plan: HooksValidator CC-HK-001 to CC-HK-005

## Task
GitHub Issue #5: Implement HooksValidator: CC-HK-001 to CC-HK-005 event validation

## Overview
Add five new validation rules to HooksValidator for event-level validation. The implementation leverages the existing validator pattern and adds new event category constants.

## Rules to Implement

| Rule | Severity | Description |
|------|----------|-------------|
| CC-HK-001 | HIGH | Invalid hook event - validate against 13 valid events |
| CC-HK-002 | HIGH | Prompt hook on wrong event - type:"prompt" only for Stop/SubagentStop |
| CC-HK-003 | HIGH | Missing matcher for tool events - PreToolUse/PermissionRequest/PostToolUse/PostToolUseFailure require matcher |
| CC-HK-004 | HIGH | Matcher on non-tool event - non-tool events must not have matcher |
| CC-HK-005 | HIGH | Missing type field - hook must have type:"command" or type:"prompt" |

## Implementation Steps

### Step 1: Add event category constants to schemas/hooks.rs
- Add `TOOL_EVENTS` constant: PreToolUse, PermissionRequest, PostToolUse, PostToolUseFailure
- Add `PROMPT_EVENTS` constant: Stop, SubagentStop
- Add helper methods `is_tool_event()` and `is_prompt_event()`

### Step 2: Implement CC-HK-001 - Invalid hook event
- Check each event name against VALID_EVENTS
- Emit error with "did you mean" suggestion for close matches

### Step 3: Implement CC-HK-002 - Prompt hook on wrong event
- When matching Hook::Prompt, verify event is Stop or SubagentStop
- Suggest using type:"command" or changing to valid event

### Step 4: Implement CC-HK-003 - Missing matcher for tool events
- For tool events, verify matcher field is present
- Suggest adding `"matcher": "*"` to match all tools

### Step 5: Implement CC-HK-004 - Matcher on non-tool event
- For non-tool events, verify matcher field is absent
- Suggest removing the matcher field

### Step 6: Implement CC-HK-005 - Missing type field
- Pre-parse as serde_json::Value to detect missing type before typed parse fails
- Emit specific error with suggestion to add type field

### Step 7: Create test fixtures
- `invalid-event.json` - CC-HK-001
- `prompt-on-wrong-event.json` - CC-HK-002
- `missing-matcher.json` - CC-HK-003
- `matcher-on-wrong-event.json` - CC-HK-004

### Step 8: Add unit tests
Comprehensive tests for all 5 rules covering:
- Valid cases pass
- Invalid cases fail with correct rule ID
- Edge cases (case sensitivity, all 13 events, etc.)

### Step 9: Update module documentation
- Change doc comment from "CC-HK-006 to CC-HK-009" to "CC-HK-001 to CC-HK-009"

## Files to Modify

| File | Action |
|------|--------|
| `crates/agnix-core/src/schemas/hooks.rs` | Add constants and helpers |
| `crates/agnix-core/src/rules/hooks.rs` | Add 5 validation rules + tests |
| `tests/fixtures/hooks/invalid-event.json` | Create |
| `tests/fixtures/hooks/prompt-on-wrong-event.json` | Create |
| `tests/fixtures/hooks/missing-matcher.json` | Create |
| `tests/fixtures/hooks/matcher-on-wrong-event.json` | Create |

## Complexity
**Medium** - Follows established patterns, main complexity is CC-HK-005 pre-parsing

## Risks
- CC-HK-005 double-parsing adds complexity (mitigated: standard technique)
- Event names must match exactly (case-sensitive per spec)
